# Firebase Data Connect Schema
# Defines the database structure for the punch card application

type User @table(key: "id") {
  id: String! # Firebase Auth UID
  name: String!
  email: String! @unique
  favoriteCategory: Int # References hardcoded categories (1-7) from constants/categories.ts
  createdDatetime: Timestamp @default(expr: "request.time")
}

type Business @table(key: "id") {
  id: String! @default(expr: "uuidV4()")
  name: String!
  contactName: String
  email: String
  phoneNumber: String
  address: String
  categoryId: Int! # References hardcoded categories (1-7) from constants/categories.ts
  image: String # Base64 encoded image
  createdDatetime: Timestamp @default(expr: "request.time")
  description: String
  punchNum: Int
  expirationDurationInDays: Int @default(expr: "30")
  # Location coordinates for distance calculations
  latitude: Float
  longitude: Float
}

type PunchCard @table(key: "id") {
  id: String! @default(expr: "uuidV4()")
  businessId: String!
  userId: String!
  maxPunches: Int!
  createdAt: Timestamp @default(expr: "request.time")
  expiresAt: Timestamp!
  completedAt: Timestamp # When the card was fully redeemed/completed
  
  # Relationships
  business: Business! @ref(fields: "businessId", references: "id")
  user: User! @ref(fields: "userId", references: "id")
}

type Punch @table(key: "id") {
  id: String! @default(expr: "uuidV4()")
  cardId: String!
  punchTime: Timestamp @default(expr: "request.time")
  
  # Relationships
  card: PunchCard! @ref(fields: "cardId", references: "id")
}

type PunchCode @table(key: "id") {
  id: String! @default(expr: "uuidV4()")
  code: String! @unique # 6-digit code
  cardId: String!
  businessId: String!
  userId: String!
  createdAt: Timestamp @default(expr: "request.time")
  expiresAt: Timestamp!
  usedAt: Timestamp
  isUsed: Boolean @default(value: false)
  
  # Relationships
  card: PunchCard! @ref(fields: "cardId", references: "id")
  business: Business! @ref(fields: "businessId", references: "id")
  user: User! @ref(fields: "userId", references: "id")
}

